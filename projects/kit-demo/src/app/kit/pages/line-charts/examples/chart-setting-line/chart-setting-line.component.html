@if ((options | async); as chartOptions) {
  <krui-chart
    [height]="600"
    [setDefIfContainerSizeInvalid]="true"
    [bgColor]="chartOptions.view?.wrapper?.bgColor"
    [borderColor]="chartOptions.view?.wrapper?.borderColor"
    [borderRadius]="chartOptions.view?.wrapper?.borderRadius"
    [chartOrientation]="chartOptions.view?.tooltip?.chartOrientation"
    [legendAxis]="chartOptions.view?.legend?.legendAxis"
    [legendLayer]="chartOptions.view?.legend?.legendLayer"
    [legendPosition]="chartOptions.view?.legend?.legendPosition"
    [legendTrend]="chartOptions.view?.legend?.legendTrend"
    [legendType]="chartOptions.view?.legend?.legendType"
    [legend]="chartOptions.view?.legend?.legend"
    [marginBottom]="chartOptions.view?.wrapper?.marginBottom"
    [marginLeft]="chartOptions.view?.wrapper?.marginLeft"
    [marginRight]="chartOptions.view?.wrapper?.marginRight"
    [marginTop]="chartOptions.view?.wrapper?.marginTop"
    [resizeObserveType]="chartOptions.view?.resizeObserveType"
    [smartScrollEnable]="chartOptions.view?.wrapper?.smartScrollEnable"
    [smartScrollHeight]="chartOptions.view?.wrapper?.smartScrollHeight"
    [toolbarJustifyContent]="chartOptions.view?.toolbar?.toolbarJustifyContent"
    [toolbarPosition]="chartOptions.view?.toolbar?.toolbarPosition"
    [toolbar]="chartOptions.view?.toolbar?.toolbar"
    [tooltipColor]="chartOptions.view?.tooltip?.tooltipColor"
    [tooltipMarkerCrossSize]="chartOptions.view?.tooltip?.tooltipMarkerCrossSize"
    [tooltipMarkerType]="chartOptions.view?.tooltip?.tooltipMarkerType"
    [tooltipShowMilliseconds]="chartOptions.view?.tooltip?.tooltipShowMilliseconds"
    [tooltipType]="chartOptions.view?.tooltip?.tooltipType"
    [tooltipWidth]="chartOptions.view?.tooltip?.tooltipWidth"
    [tooltip]="chartOptions.view?.tooltip?.tooltip"
    [zoomType]="chartOptions.view?.zoomType"
  >
    <krui-chart-layer
      [layerTitle]="chartOptions.view?.layer?.layerTitle"
      [tooltipColor]="chartOptions.view?.layer?.tooltipColor"
      [tooltipEnable]="chartOptions.view?.layer?.tooltipEnable"
      [zoomPrimaryEnable]="chartOptions.view?.layer?.zoomPrimaryEnable"
      [zoomSecondaryEnable]="chartOptions.view?.layer?.zoomSecondaryEnable">
      <krui-chart-axis
        [color]="chartOptions.view?.axisX?.color"
        [drawAxisLabelLine]="chartOptions.view?.axisX?.drawAxisLabelLine"
        [drawAxisLabel]="chartOptions.view?.axisX?.drawAxisLabel"
        [fontColor]="chartOptions.view?.axisX?.fontColor"
        [position]="chartOptions.view?.axisX?.position"
        [primary]="chartOptions.view?.axisX?.primary"
        [ticks]="chartOptions.view?.axisX?.ticks"
        [type]="chartOptions.view?.axisX?.type"
        name="x"
      ></krui-chart-axis>
      <krui-chart-axis
        [color]="chartOptions.view?.axisY?.color"
        [drawAxisLabelLine]="chartOptions.view?.axisY?.drawAxisLabelLine"
        [drawAxisLabel]="chartOptions.view?.axisY?.drawAxisLabel"
        [fontColor]="chartOptions.view?.axisY?.fontColor"
        [position]="chartOptions.view?.axisY?.position"
        [primary]="chartOptions.view?.axisY?.primary"
        [ticks]="chartOptions.view?.axisY?.ticks"
        [type]="chartOptions.view?.axisY?.type"
        name="y"
      ></krui-chart-axis>

      <krui-chart-grid
        [color]="chartOptions.view?.gridX?.color"
        [drawGrid]="chartOptions.view?.gridX?.drawGrid"
        axis="x"
      ></krui-chart-grid>
      <krui-chart-grid
        [color]="chartOptions.view?.gridY?.color"
        [drawGrid]="chartOptions.view?.gridY?.drawGrid"
        axis="y"
      ></krui-chart-grid>

      <krui-chart-data-layer
        [lineType]="chartOptions.view?.lineLayer?.config.lineType"
        [captions]="['Тестовый пример']"
        [color]="chartOptions.view?.lineLayer?.config.color"
        [colors]="[chartOptions.view?.lineLayer?.config.color, '#fff']"
        [data]="chartOptions.data"
        [lineOpacity]="chartOptions.view?.lineLayer?.config.lineOpacity"
        [lineDynamics]="chartOptions.view?.lineLayer?.config?.lineDynamics"
        [animation]="chartOptions.view?.lineLayer?.common?.animation"
        [breakPointMarker]="chartOptions.view?.lineLayer?.config?.breakPointMarker"
        [breakPointSize]="chartOptions.view?.lineLayer?.config?.breakPointSize"
        [breakPoint]="chartOptions.view?.lineLayer?.config?.breakPoint"
        [dataPointMarker]="chartOptions.view?.lineLayer?.config?.dataPointMarker"
        [dataPointType]="chartOptions.view?.lineLayer?.config?.dataPointType"
        [durationAnimation]="chartOptions.view?.lineLayer?.common?.durationAnimation"
        [durationToggleAnimation]="chartOptions.view?.lineLayer?.common?.durationToggleAnimation"
        [endPointSize]="chartOptions.view?.lineLayer?.config?.endPointSize"
        [endPoint]="chartOptions.view?.lineLayer?.config?.endPoint"
        [interpolateEnable]="chartOptions.view?.lineLayer?.config?.interpolateEnable"
        [reRangeThenDataChange]="chartOptions.view?.lineLayer?.common?.reRangeThenDataChange"
        [reRangeThenLegendClick]="chartOptions.view?.lineLayer?.common?.reRangeThenLegendClick"
        [showValues]="chartOptions.view?.lineLayer?.common?.showValues"
        [valuesFontSizePx]="chartOptions.view?.lineLayer?.common?.valuesFontSizePx"
        [workgroundPadding]="chartOptions.view?.lineLayer?.common?.workgroundPadding"
        kruiChartLine
      ></krui-chart-data-layer>
    </krui-chart-layer>
  </krui-chart>
}

<div [formGroup]="optionsForm" class="container">
  <krui-accordion [multiple]="true" class="container__accordion">
    <ng-template kruiAccordionItem="График">
      <div class="tab-content" formGroupName="wrapper">
        <div class="tab-content__item">
          <div>Цвет фона</div>
          <krui-form-field class="color-select">
            <input
              formControlName="bgColor"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Цвет границы</div>
          <krui-form-field class="color-select">
            <input
              formControlName="borderColor"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <hr class="tab-delimeter" />
        <div class="tab-content__item">
          <krui-checkbox class="krui-disabled" formControlName="smartScrollEnable" size="md">Смарт-скролл
          </krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Цвет смарт-скролла</div>
          <krui-form-field class="color-select">
            <input
              class="krui-disabled"
              formControlName="smartScrollColor"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
      </div>
    </ng-template>
    <ng-template kruiAccordionItem="Тоолтип">
      <div class="tab-content" formGroupName="tooltip">
        <div class="tab-content__item">
          <krui-checkbox formControlName="tooltip" size="md">Тултип</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="tooltipShowMilliseconds" size="md">Показывать миллисекунды</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Тип тултипа</div>
          <krui-form-field>
            <select formControlName="tooltipType" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['fullLine', 'dataPoint']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Маркер тултипа</div>
          <krui-form-field>
            <select formControlName="tooltipMarkerType" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['line', 'horizontal-line', 'smallCross', 'fullscreenCross', 'none']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Цвет маркера</div>
          <krui-form-field class="color-select">
            <input
              formControlName="tooltipColor"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <div
          [class.krui-disabled]="optionsForm.controls.tooltip.controls.tooltipMarkerType.value !== 'smallCross'"
          class="tab-content__item"
        >
          <label>Размер маркера</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="20"
            [min]="1"
            [step]="1"
            formControlName="tooltipMarkerCrossSize"
          ></krui-slider>
        </div>
        <div class="tab-content__item">
          <label>Толщина линии</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="20"
            [min]="1"
            [step]="1"
            formControlName="tooltipWidth"
          ></krui-slider>
        </div>
      </div>
    </ng-template>
    <ng-template kruiAccordionItem="Панель управления">
      <div class="tab-content" formGroupName="toolbar">
        <div class="tab-content__item">
          <krui-checkbox formControlName="toolbar" size="md">Панель управления</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Позиция</div>
          <krui-form-field>
            <select formControlName="toolbarPosition" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['top', 'bottom']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Выравнивание</div>
          <krui-form-field>
            <select formControlName="toolbarJustifyContent" size="sm" kruiInput>
              <ng-container
                *ngFor="
                  let option of ['center', 'flex-start', 'flex-end', 'space-between', 'space-around', 'space-evenly']
                "
              >
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
      </div>
    </ng-template>
    <ng-template kruiAccordionItem="Легенда">
      <div class="tab-content" formGroupName="legend">
        <div class="tab-content__item">
          <krui-checkbox formControlName="legend" size="md">Легенда</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox
            [disabled]="optionsForm.controls.legend.controls.legendType.value === 'simple-style'"
            formControlName="legendLayer"
            size="md"
          >Метки слоя
          </krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox
            [disabled]="optionsForm.controls.legend.controls.legendType.value === 'simple-style'"
            formControlName="legendAxis"
            size="md"
          >Метки осей
          </krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox class="krui-disabled" formControlName="legendTrend" size="md"
          >Метки трендов и столбцов
          </krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox class="krui-disabled" formControlName="legendHoverEffect" size="md"
          >Эффект подстветки трендов
          </krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Тип легенды</div>
          <krui-form-field>
            <select formControlName="legendType" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['default', 'simple-style']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Позиция</div>
          <krui-form-field>
            <select formControlName="legendPosition" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['top', 'bottom']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
      </div>
    </ng-template>
    <ng-template kruiAccordionItem="Зум">
      <div class="tab-content" formGroupName="layer">
        <div class="tab-content__item">
          <krui-checkbox formControlName="zoomPrimaryEnable" size="md">Зум по оси х</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="zoomSecondaryEnable" size="md">Зум по оси y</krui-checkbox>
        </div>
      </div>

      <div class="tab-content">
        <div class="tab-content__item">
          <div>Тип зума</div>
          <krui-form-field>
            <select formControlName="zoomType" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['none', 'brush', 'scroll']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
      </div>
    </ng-template>
    <ng-template kruiAccordionItem="Ось Х">
      <div class="tab-content" formGroupName="axisX">
        <div class="tab-content__item">
          <div>Тип оси х</div>
          <krui-form-field>
            <select formControlName="type" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['time', 'number', 'enum']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Позиция</div>
          <krui-form-field>
            <select formControlName="position" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['top', 'bottom']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <krui-checkbox class="krui-disabled" formControlName="primary" size="md">Главная ось</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="drawAxisLabel" size="md">Отображать значения</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="drawAxisLabelLine" size="md">Отображать метки значений</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Цвет Оси</div>
          <krui-form-field class="color-select">
            <input
              formControlName="color"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Цвет значений</div>
          <krui-form-field class="color-select">
            <input
              formControlName="fontColor"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <label>Количество меток</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="10"
            [min]="2"
            [step]="1"
            formControlName="ticks"
          ></krui-slider>
        </div>
      </div>
      <hr class="tab-delimeter" />
      <div class="tab-content" formGroupName="gridX">
        <div class="tab-content__item">
          <krui-checkbox formControlName="drawGrid" size="md">Отображать сетку</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Цвет значений сетки</div>
          <krui-form-field class="color-select">
            <input
              formControlName="color"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
      </div>
    </ng-template>
    <ng-template kruiAccordionItem="Ось Y">
      <div class="tab-content" formGroupName="axisY">
        <div class="tab-content__item">
          <div>Тип оси у</div>
          <krui-form-field>
            <select formControlName="type" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['time', 'number', 'enum']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Позиция</div>
          <krui-form-field>
            <select formControlName="position" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['left', 'right']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <krui-checkbox class="krui-disabled" formControlName="primary" size="md">Главная ось</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="drawAxisLabel" size="md">Отображать значения</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="drawAxisLabelLine" size="md">Отображать метки значений</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Цвет Оси</div>
          <krui-form-field class="color-select">
            <input
              formControlName="color"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Цвет значений</div>
          <krui-form-field class="color-select">
            <input
              formControlName="fontColor"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <label>Количество меток</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="10"
            [min]="2"
            [step]="1"
            formControlName="ticks"
          ></krui-slider>
        </div>
      </div>
      <hr class="tab-delimeter" />
      <div class="tab-content" formGroupName="gridY">
        <div class="tab-content__item">
          <krui-checkbox formControlName="drawGrid" size="md">Отображать сетку</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Цвет значений сетки</div>
          <krui-form-field class="color-select">
            <input
              formControlName="color"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
      </div>
    </ng-template>
    <ng-template formGroupName="lineLayer" kruiAccordionItem="Тренд">
      <div class="tab-content" formGroupName="config">
        <div class="tab-content__item">
          <div>Тип</div>
          <krui-form-field>
            <select formControlName="lineType" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['line' , 'area']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Цвет</div>
          <krui-form-field class="color-select">
            <input
              formControlName="color"
              size="sm"
              kruiChartInputColorWrapper
              kruiInput
              type="color"
            />
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="interpolateEnable" size="md">Интерполяция значений</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Тип тренда</div>
          <krui-form-field>
            <select formControlName="lineDynamics" size="sm" kruiInput>
              <ng-container *ngFor="let option of interpolation">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <label>Прозрачность</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="1"
            [min]="0"
            [step]="0.1"
            formControlName="lineOpacity"
          ></krui-slider>
        </div>
        <hr class="tab-delimeter" />
        <div class="tab-content__item">
          <div>Точки данных</div>
          <krui-form-field>
            <select formControlName="dataPointType" size="sm" kruiInput>
              <ng-container *ngFor="let option of ['all', 'partial']">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <div>Маркер точки данных</div>
          <krui-form-field>
            <select formControlName="dataPointMarker" size="sm" kruiInput>
              <ng-container *ngFor="let option of dataMarkers">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <hr class="tab-delimeter" />
        <div class="tab-content__item">
          <krui-checkbox formControlName="breakPoint" size="md">Точки разрыва данных</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <div>Маркер точки разрыва данных</div>
          <krui-form-field>
            <select formControlName="breakPointMarker" size="sm" kruiInput>
              <ng-container *ngFor="let option of markers">
                <option [value]="option">{{ option }}</option>
              </ng-container>
            </select>
          </krui-form-field>
        </div>
        <div class="tab-content__item">
          <label>Размер маркера точки разрыва данных</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="20"
            [min]="1"
            [step]="1"
            formControlName="breakPointSize"
          ></krui-slider>
        </div>
        <hr class="tab-delimeter" />
        <div class="tab-content__item">
          <krui-checkbox formControlName="endPoint" size="md">Конечная точка</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <label>Размер маркера конечной точки</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="20"
            [min]="1"
            [step]="1"
            formControlName="endPointSize"
          ></krui-slider>
        </div>
      </div>
      <hr class="tab-delimeter" />
      <div class="tab-content" formGroupName="common">
        <div class="tab-content__item">
          <krui-checkbox formControlName="showValues" size="md">Показывать значения точек</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <label>Размер значений точек, пх</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="18"
            [min]="1"
            [step]="1"
            formControlName="valuesFontSizePx"
          ></krui-slider>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="animation" size="md">Показывать анимацию</krui-checkbox>
        </div>
        <div class="tab-content__item">
          <label>Длительность анимации отрисовки</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="5000"
            [min]="100"
            [step]="100"
            formControlName="durationAnimation"
          ></krui-slider>
        </div>
        <div class="tab-content__item">
          <label>Длительность анимации переключения</label>
          <krui-slider
            [inputs]="true"
            [labels]="true"
            [max]="5000"
            [min]="100"
            [step]="100"
            formControlName="durationToggleAnimation"
          ></krui-slider>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="reRangeThenDataChange" size="md"
          >Перестраивать при изменение значений
          </krui-checkbox>
        </div>
        <div class="tab-content__item">
          <krui-checkbox formControlName="reRangeThenLegendClick" size="md"
          >Перестраивать при клике на легенду
          </krui-checkbox>
        </div>
      </div>
    </ng-template>
  </krui-accordion>
</div>

<div class="button">
  <label class="krui-form-field-label"></label>
  <button (click)="update()" kruiButton>
    <svg-icon src="kruiIconReloadCycle" kruiBtnIcon></svg-icon>
  </button>
</div>
